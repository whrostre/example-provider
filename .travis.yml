language: node_js
node_js:
  - 10
services:
  - docker
env:
  global:
    - PACT_BROKER_BASE_URL=https://will-poc.pactflow.io
    - PACT_BROKER_PUBLISH_VERIFICATION_RESULTS=true
    # Encrypted PACT_BROKER_TOKEN
    - secure: "vxUZTdESaRn+CsjkwY1s/apltqsKMwxc5NreDf8373kQLJIPeBaf3HyokjX8LTKCDrTXbhxzyDZCkuVzSmrusM8+fz2MpOK/Ji4ZkHOygVANmtucDuokCWK9qBt6F3YTbbPZsIwbnsTaodHDmRFdVqrNRNIJUpSW5g0rjJFidBsHjs9ZsFlblRtsnYe9zMSVPnGAvIHcWZWjSecGe1xfGWy+aaiQ+Oz3DVAif/PlVZLyjv/ebPLXSB108yNK7UZznHHkBuP7KgmJPy0nEOh7xNmX1+pyfRmUQUSdh6c3iGVO2zbTps3c+2K2cceDvEhGRqFH2nd+TFsfjHmOVUteu1XKoYqqlD/V6Q5D/XipGDa4XlZP4TcruHM1qvCR4+LBhOS0tKENlFTsg7XDYoamyiPyGqTaRaKt02OwibWJjL/BwUoqoG8ziv2q/PI2f44YTiU21b3wadBLXe1OHZdkO6d1bZNB/geDpNva4y7NBVxC86ESeIfEYVS14++R6k4ugwiJqtHnjUhSoDYTPk95lN7DBMEKQ4E6FSYNUWgFN+7BfZm9tY6e6GECsbvswsMhEp84CSuYYG4pM4ZfbFP0GbH2KowvdIdzPH8IsIWHDaOdEtkP2dWZtFJ/no8QOEDr/+qB/hSvRWsIlszpGOp0VIcoQr6c8JegjNHZbqdLtBk="
before_script:
  - docker pull pactfoundation/pact-cli:latest
script:
  # When a webhook triggers a build, the PACT_URL will be set. In this case, just run the verification step.
  # Otherwise, run the normal build.
  # This is just to get around the fact that Travis CI only has one build definition per repository.
  # Normally you would define a separate job for the webhook triggered verification.
  - >
    if [ -n "${PACT_URL}" ]; then
      make ci_webhook
    else
      make ci
    fi
