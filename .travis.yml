language: node_js
node_js:
  - 10
services:
  - docker
env:
  global:
    - PACT_BROKER_BASE_URL=https://will-poc.pactflow.io
    - PACT_BROKER_PUBLISH_VERIFICATION_RESULTS=true
    # Encrypted PACT_BROKER_TOKEN
    - secure: "FnYcfgDHgVphpPIDQ0as8mY7lVBkqYxAp5cqnTUxwqfUFrwwV7LYlEQCnw8RwhQJIow2jUQql0uQU5ypLpa8W/QOT2nRSLGFBY5zBGinDh0T+K7qS9q9geQPO/FUdWddd+AlGreXxDx3XQpw/1tgzRU8U2pLMTPSJFtCocWfvV5woL2o4LSgH0o/0qEmtZLRSb6aXXLg/2Tb2VFMKmColbeooRzcPizP0Xo+DSAQ5HcHe+b56RfgTJaaP4YyYuA/7mbt/r/SCQrXWtNSV/ZBv5+Fxz4XPKZfmXPX2SMWX6RvBSG5ffqqVBGIJPcmoiV4EdWGSvZ8ejYTB3P7L501G1zgbSbt7tS6tCpM6jiD0LmHchOPeeIF8zE5yVBtrbQQZ97yRXHmuVYRQlm/6+2fUNArLI9JKRmxmtOB9DOXJ+u5mdNRqVzscEEWhfXAWkS6bu7G6QTQN36msWamUvfOtW3jFGJlzZ9ImUcQtfFn+EJodrkLknGumjNoSdV8EH7g7fzkjrfNv9u4SchfSW6wDyaveogLtcZQxRAG1odi59ES3l6ouYWZHVGs5ET3AcjUGD+r+HcYOf+FnhuBQZ7J/NO0rvLxMK5mGQ1QVGxQ477o0hmr8UycLgUeYgALkce58wCpPyyVIgAc9xXikJ7OPOcVPYoVGfQHERKlVZ4aP1A="
before_script:
  - docker pull pactfoundation/pact-cli:latest
script:
  # When a webhook triggers a build, the PACT_URL will be set. In this case, just run the verification step.
  # Otherwise, run the normal build.
  # This is just to get around the fact that Travis CI only has one build definition per repository.
  # Normally you would define a separate job for the webhook triggered verification.
  - >
    if [ -n "${PACT_URL}" ]; then
      make ci_webhook
    else
      make ci
    fi
